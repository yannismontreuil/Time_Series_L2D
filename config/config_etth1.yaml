plot_shift: 1
plot_target: "y"

environment:
  # maximum is 17420
  #  T: 10000
  # Main experiment environment for ETTh1 (oil temperature as target).
  # We reuse the same router code as for the synthetic environment, but
  # the data now comes from a real-world dataset.
  data_source: etth1
  csv_path: data/ETTh1.csv
  target_column: OT

  # Number of experts and regimes.
  num_experts: 5
  num_regimes: 3

  # State dimension d = dim Ï†(x). The current feature map returns 2D features.
  state_dim: 2

  # Optional: limit the number of time steps T used from the dataset.
  # If omitted or null, the full ETTh1 series is used.
  # For example, to use only the first 2000 points, set T: 2000.
  # T: 2000

  seed: 42

  # Expert availability controls. In this ETTh1 experiment we introduce
  # multiple experts whose availability switches over time:
  #   - Expert 3 (index 2) is unavailable on several disjoint intervals.
  #   - Expert 5 (index 4) arrives late and is only available on
  #     specified arrival intervals.
  unavailable_expert_idx: 0
  unavailable_intervals:
    - [1000, 3000]
    - [9000, 22000]
  arrival_expert_idx: 4
  arrival_intervals:
    # Expert 5 becomes available only later in the series.
    - [9000, 22000]

routers:
  beta: 0.0
  staleness_threshold: null

  factorized_slds:
    enabled: true
    num_regimes: 3
    shared_dim: 1
    idiosyncratic_dim: 2
    delta_max: 1000
    R_scalar: 1.0

    exploration: ["g_z"]
    em_enabled: true
    em_offline_full_feedback: true
    em_tk: 5000
    # rounds of EM to run during warm-start.
    em_n: 5
    em_samples: 20
    em_burn_in: 5
    # Offline EM runs without validation.
    # Offline EM validation.
    em_use_validation: true
    # Validation strategy: "tail" or "rolling".
    em_val_strategy: "rolling"
    # Size of the validation tail (fraction of em_tk).
    em_val_fraction: 0.4
    # Rolling-origin window length (steps). Falls back to em_val_len if null.
    em_val_roll_len: 200
    # Number of rolling validation windows in the tail.
    em_val_roll_splits: 3
    # Optional stride between rolling windows; null -> evenly spaced.
    em_val_roll_stride: null
    em_val_len: null
    em_theta_lr: 0.001
    em_theta_steps: 1 # ?
    em_print_val_loss: true
    em_eps_n: 1.0e-3

    # Online (sliding-window) EM adaptation.
    em_online_enabled: true
    em_online_window: 500
    em_online_period: 300
    em_online_n: 2
    em_online_samples: 20
    em_online_burn_in: 5
    em_online_theta_lr: 0.001
    em_online_theta_steps: 1 # ?
    em_online_eps_n: 1.0e-3
    em_online_print_val_loss: true
    # If null, defaults to em_tk + 1.
    em_online_start_t: null

    transition_mode: "linear"

baselines:
  l2d:
    arch: "mlp"
    learning_rate: 0.001
    hidden_dim: 16
    window_size: 1
    alpha: 1.0
    beta: null

  l2d_sw:
    arch: "rnn"
    learning_rate: 0.001
    hidden_dim: 16
    window_size: 200
    alpha: 1.0
    beta: null

  linucb:
    alpha: 1.0
    regularization: 1.0

  neuralucb:
    hidden_dim: 32
    lr: 0.001
    lambda_reg: 1.0


horizon_planning:
  # Start horizon planning after EM warm-start.
  t0: 1000

  H: 100
  method: "20_monte_carlo"

  # Coverage tolerance for active-set scheduling.
  delta: 0.1

  scenario_generator:
    type: "gaussian_ar1"
    rho: 0.9
    sigma0: 0.1
    q_scale: 0.1
    noise_scale: 1.0
